<%- include('../../partials/header') %>

<style>
  .dashboard-container {
    max-width: 900px;
    margin: 40px auto 0 auto;
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.10);
    padding: 32px 20px 24px 20px;
    min-height: 340px;
    color: #2d3a4b;
  }
  .dashboard-title {
    text-align: center;
    color: #2d3a4b;
    font-size: 2em;
    margin-bottom: 32px;
    letter-spacing: 1px;
    font-weight: 700;
  }
  .dashboard-actions {
    margin-bottom: 24px;
    text-align: right;
  }
  .action-btn {
    display: inline-block; padding: 7px 16px; border-radius: 6px; font-weight: 500;
    text-decoration: none; margin-right: 8px; transition: opacity 0.2s;
    border: none; cursor: pointer;
  }
  .action-btn.add { background: #28a745; color: #fff !important; }
  .action-btn.edit { background: #ffc107; color: #212529 !important; }
  .action-btn.delete { background: #dc3545; color: #fff !important; }
  .action-btn:hover { opacity: 0.85; }
  table { width: 100%; border-collapse: collapse; background: transparent; }
  th, td { 
    padding: 10px 8px; 
    border: 2px solid #bdbdbd; /* ƒê·∫≠m h∆°n */
    text-align: left; 
    background: #fff;
  }
  th { 
    background: #f0f2f5 !important; /* ƒê·∫≠m h∆°n, s√°ng h∆°n */
    font-weight: 600;
    color: #222;
  }
  tbody tr:hover { background: #f5f7fa; }
  .product-img { max-width: 60px; max-height: 60px; border-radius: 6px; }
  /* Modal style */
  .modal-backdrop {
    position: fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); z-index:1000; display:none;
  }
  .modal {
    position: fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#fff; color:#2d3a4b; padding:24px 28px; border-radius:8px; min-width:340px; z-index:1001; display:none;
    box-shadow:0 8px 32px rgba(0,0,0,0.18);
  }
  .modal-header { font-size:18px; font-weight:600; margin-bottom:16px; }
  .modal-actions { margin-top:18px; text-align:right; }
  .modal label { display:block; font-weight:500; margin-bottom:4px; }
  .modal input, .modal textarea, .modal select {
    width:100%; padding:7px 10px; border-radius:4px; border:1.5px solid #bbb; margin-bottom:12px; background:#f7f7f7; color:#2d3a4b;
  }
  .modal button { margin-left:8px; }
</style>

<div class="dashboard-container">
  <div class="dashboard-title">Qu·∫£n l√Ω S·∫£n ph·∫©m</div>
  <div class="dashboard-actions" style="margin-bottom:24px;">
    <button class="action-btn add" onclick="openAddModal()">+ Th√™m s·∫£n ph·∫©m</button>
  </div>
  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Danh m·ª•c</th>
          <th>Gi√°</th>
          <th>S·ªë l∆∞·ª£ng</th>
          <th>Thu·ªôc t√≠nh</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <% if (products.length === 0) { %>
        <tr>
          <td colspan="8" style="text-align:center;padding:18px;">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</td>
        </tr>
        <% } %>
        <% products.forEach(function(product, idx) { %>
        <tr>
          <td><%= idx+1 %></td>
          <td>
            <% if(product.image) { %>
              <img src="<%= product.image %>" class="product-img" />
            <% } %>
          </td>
          <td><%= product.name %></td>
          <td>
            <% let cat = categories.find(c => c.id === product.categoryId); %>
            <%= cat ? cat.name : '' %>
          </td>
          <td><%= product.price ? product.price.toLocaleString('vi-VN') : '' %> ƒë</td>
          <td><%= product.quantity %></td>
          <td><%= product.attributes %></td>
          <td>
            <button class="action-btn edit" onclick="openEditModal('<%= product.id %>', `<%= product.name.replace(/`/g, '\\`') %>`, '<%= product.categoryId %>', '<%= product.price %>', `<%= product.attributes ? product.attributes.replace(/`/g, '\\`') : '' %>`, '<%= product.quantity %>', `<%= product.image ? product.image.replace(/`/g, '\\`') : '' %>`)">‚úèÔ∏è S·ª≠a</button>
            <button class="action-btn delete" onclick="openDeleteModal('<%= product.id %>', `<%= product.name.replace(/`/g, '\\`') %>`)">üóëÔ∏è X√≥a</button>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal backdrop -->
<div id="modal-backdrop" class="modal-backdrop"></div>

<!-- Add Product Modal -->
<div id="add-modal" class="modal">
  <div class="modal-header">Th√™m s·∫£n ph·∫©m</div>
  <form id="add-form" action="/shop/<%= slug %>/products/create" method="POST" enctype="multipart/form-data">
    <label for="add-name">T√™n s·∫£n ph·∫©m</label>
    <input id="add-name" name="name" placeholder="T√™n s·∫£n ph·∫©m" required>
    <label for="add-categoryId">Danh m·ª•c</label>
    <select id="add-categoryId" name="categoryId" required>
      <option value="">-- Ch·ªçn danh m·ª•c --</option>
      <% categories.forEach(function(cat) { %>
        <option value="<%= cat.id %>"><%= cat.name %></option>
      <% }) %>
    </select>
    <label for="add-price">Gi√° s·∫£n ph·∫©m</label>
    <input id="add-price" name="price" type="number" placeholder="Gi√° s·∫£n ph·∫©m" required>
    <label for="add-quantity">S·ªë l∆∞·ª£ng</label>
    <input id="add-quantity" name="quantity" type="number" placeholder="S·ªë l∆∞·ª£ng" required>
    <label for="add-attributes">N·ªôi dung thu·ªôc t√≠nh</label>
    <textarea id="add-attributes" name="attributes" placeholder="N·ªôi dung thu·ªôc t√≠nh"></textarea>
    <label for="add-image">H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
    <input id="add-image" name="image" type="file" accept="image/*">
    <div class="modal-actions">
      <button type="button" onclick="closeModal()">H·ªßy</button>
      <button type="submit" class="action-btn add">Th√™m</button>
    </div>
  </form>
</div>

<!-- Edit Product Modal -->
<div id="edit-modal" class="modal">
  <div class="modal-header">S·ª≠a s·∫£n ph·∫©m</div>
  <form id="edit-form" method="POST" enctype="multipart/form-data">
    <label for="edit-name">T√™n s·∫£n ph·∫©m</label>
    <input id="edit-name" name="name" placeholder="T√™n s·∫£n ph·∫©m" required>
    <label for="edit-categoryId">Danh m·ª•c</label>
    <select id="edit-categoryId" name="categoryId" required>
      <option value="">-- Ch·ªçn danh m·ª•c --</option>
      <% categories.forEach(function(cat) { %>
        <option value="<%= cat.id %>"><%= cat.name %></option>
      <% }) %>
    </select>
    <label for="edit-price">Gi√° s·∫£n ph·∫©m</label>
    <input id="edit-price" name="price" type="number" placeholder="Gi√° s·∫£n ph·∫©m" required>
    <label for="edit-quantity">S·ªë l∆∞·ª£ng</label>
    <input id="edit-quantity" name="quantity" type="number" placeholder="S·ªë l∆∞·ª£ng" required>
    <label for="edit-attributes">N·ªôi dung thu·ªôc t√≠nh</label>
    <textarea id="edit-attributes" name="attributes" placeholder="N·ªôi dung thu·ªôc t√≠nh"></textarea>
    <label for="edit-image">H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
    <input id="edit-image" name="image" type="file" accept="image/*">
    <div class="modal-actions">
      <button type="button" onclick="closeModal()">H·ªßy</button>
      <button type="submit" class="action-btn edit">L∆∞u</button>
    </div>
  </form>
</div>

<!-- Delete Product Modal -->
<div id="delete-modal" class="modal">
  <div class="modal-header">X√°c nh·∫≠n x√≥a s·∫£n ph·∫©m</div>
  <form id="delete-form" method="POST">
    <div id="delete-message" style="margin-bottom:16px;"></div>
    <div class="modal-actions">
      <button type="button" onclick="closeModal()">H·ªßy</button>
      <button type="submit" class="action-btn delete">X√≥a</button>
    </div>
  </form>
</div>

<script>
  function openAddModal() {
    document.getElementById('modal-backdrop').style.display = 'block';
    document.getElementById('add-modal').style.display = 'block';
  }

  function openEditModal(id, name, categoryId, price, attributes, quantity, image) {
    document.getElementById('modal-backdrop').style.display = 'block';
    document.getElementById('edit-modal').style.display = 'block';
    document.getElementById('edit-name').value = name;
    document.getElementById('edit-categoryId').value = categoryId;
    document.getElementById('edit-price').value = price;
    document.getElementById('edit-attributes').value = attributes;
    document.getElementById('edit-quantity').value = quantity;
    // Kh√¥ng set value cho file input (b·∫£o m·∫≠t tr√¨nh duy·ªát)
    document.getElementById('edit-form').action = '/shop/<%= slug %>/products/' + id + '/edit';
  }

  function openDeleteModal(id, name) {
    document.getElementById('modal-backdrop').style.display = 'block';
    document.getElementById('delete-modal').style.display = 'block';
    document.getElementById('delete-message').innerText = 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m "' + name + '"?';
    document.getElementById('delete-form').action = '/shop/<%= slug %>/products/' + id + '/delete';
  }

  function closeModal() {
    document.getElementById('modal-backdrop').style.display = 'none';
    document.getElementById('add-modal').style.display = 'none';
    document.getElementById('edit-modal').style.display = 'none';
    document.getElementById('delete-modal').style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('modal-backdrop').onclick = closeModal;
  });
</script>

<%- include('../../partials/footer') %>